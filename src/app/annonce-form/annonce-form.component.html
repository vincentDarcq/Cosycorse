<div class="component">
  <form (keydown.enter)="$event.preventDefault()" [formGroup]="form" (ngSubmit)="submit()" #annonceForm="ngForm">
    <div class="step" fxLayout="row">
      <div class="item">
        Quel type de logement proposez-vous ?
      </div>
      <mat-radio-group formControlName="logement" name="logement" required fxLayoutGap="3%">
        <mat-radio-button *ngFor="let l of logementsType" value="{{l}}">{{l}}</mat-radio-button>
        <div class="control" 
          *ngIf="form.get('logement')!.invalid">
          Séléction obligatoire
        </div>
      </mat-radio-group>
      <div class="ville" fxLayout="column">
        <mat-form-field class="item field input_ville">
          <input matInput type="text" name="ville" required placeholder="Ville" (keyup)="affineVille()"
          formControlName="ville" [matAutocomplete]="villescomplete">
        </mat-form-field>
        <mat-autocomplete #villescomplete="matAutocomplete">
          <mat-option *ngFor="let ville of villeAutoComplete" [value]="ville">
            {{ ville }}
          </mat-option>
        </mat-autocomplete>
        <div class="control" 
          *ngIf="form.get('ville')!.invalid">
          Ville obligatoire
        </div>
      </div>
    </div>
    <div class="step">
      <mat-form-field class="item addresse">
        <div fxLayout="column" fxLayoutGap="5px">
          <div class="input_addresse" fxLayout="row" fxLayoutGap="5px">
            <input type="text" matInput formControlName="adresse" name="adresse" id="adresse" required
              [matAutocomplete]="auto" class="form-control" placeholder="Adresse" (keyup)="enter($event)" />
            <span class="searchLocation" (click)="adresseFromGeoApi()">Chercher</span>
          </div>
          <div class="control" *ngIf="mauvaiseAdresse">Cette adresse n'est pas en corse</div>
          <div class="control" *ngIf="noSearch">Cliquez sur le bouton Chercher pour vérifier la bonne localisation
          </div>
          <div class="control" 
            *ngIf="form.get('adresse')!.invalid && (form.get('adresse')!.dirty || form.get('adresse')!.touched)">
            Adresse obligatoire
          </div>
          <div id="map" leaflet *ngIf="displayMap" (leafletMapReady)="onMapReady($event)" [leafletOptions]="mapOptions">
          </div>
        </div>
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let result of searchResults" [value]="result.address" (click)="selectAdresse(result)">
            {{ result.address }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div>
    <div class="step">
      <div fxLayout="row" fxLayoutGap="10px">
        <mat-form-field class="item field" fxLayoutGap="20px">
          <label class="number">Combien de voyageurs ?</label>
          <input matInput type="number" name="nbVoyageur" formControlName="nbVoyageur">
          <div class="control" 
            *ngIf="form.get('nbVoyageur')!.invalid && (form.get('nbVoyageur')!.dirty || form.get('nbVoyageur')!.touched)">
            Le nombre doit être > 0
          </div>
        </mat-form-field>
        <mat-form-field class="field" fxLayoutGap="20px">
          <label class="number">Combien de lits avez-vous ?</label>
          <input matInput type="number" name="nbLits" formControlName="nbLits">
          <div class="control" 
            *ngIf="form.get('nbLits')!.invalid && (form.get('nbLits')!.dirty || form.get('nbLits')!.touched)">
            Le nombre doit être > 0
          </div>
        </mat-form-field>
        <mat-form-field class="field" fxLayoutGap="20px">
          <label class="number">Combien de salle de bain ?</label>
          <input matInput type="number" name="nbSdb" formControlName="nbSdb">
          <div class="control" 
            *ngIf="form.get('nbSdb')!.invalid && (form.get('nbSdb')!.dirty || form.get('nbSdb')!.touched)">
            Le nombre doit être > 0
          </div>
        </mat-form-field>
      </div>
    </div>
    <div class="step" fxLayout="row">
      <div class="item">
        Equipements de votre logement ?
      </div>
      <div>
        <mat-checkbox *ngFor="let e of equipementsList" value="{{e.element}}" (change)="valueChange(e.element, $event)">
          <i [ngClass]="e.logo"></i>
          {{e.element}}
        </mat-checkbox>
      </div>
      <div>
        <mat-checkbox *ngFor="let e of equipementsSecuriteList" value="{{e.element}}"
          (change)="valueChange(e.element, $event)">
          <i [ngClass]="e.logo"></i>
          {{e.element}}
        </mat-checkbox>
      </div>
    </div>
    <div class="step">
      <ngx-dropzone (change)="onDropZone($event)">
        <ngx-dropzone-label>Ajoutez/Deposez des photos</ngx-dropzone-label>
        <ngx-dropzone-preview *ngFor="let f of files" [removable]="true" (removed)="onRemove(f)">
          <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
        </ngx-dropzone-preview>
      </ngx-dropzone>
    </div>
    <div class="step" fxLayout="row">
      <div class="item">
        Décrivez plus amplement votre logement :
      </div>
      <div>
        <textarea type="text" placeholder="Description" formControlName="description" name="description" id="description"
          rows="4"></textarea>
      </div>
    </div>
    <div class="step">
      <div fxLayout="row" fxLayoutGap="10px">
        <mat-radio-group formControlName="fumeur" name="fumeur" fxLayoutGap="3%">
          <mat-radio-button value="true">fumeur autorisé</mat-radio-button>
          <mat-radio-button value="false">non fumeur</mat-radio-button>
        </mat-radio-group>
        <mat-radio-group formControlName="animaux" name="animaux" fxLayoutGap="3%">
          <mat-radio-button value="true">animaux autorisés</mat-radio-button>
          <mat-radio-button value="false">animaux non autorisés</mat-radio-button>
        </mat-radio-group>
        <mat-radio-group formControlName="access_handicap" name="access_handicap" fxLayoutGap="3%">
          <mat-radio-button value="true">accessibilité handicapé</mat-radio-button>
          <mat-radio-button value="false">pas d'accès handicapé</mat-radio-button>
        </mat-radio-group>
        <mat-form-field class="item field" fxLayoutGap="20px">
          <label class="number">Prix à la nuit ?</label>
          <div fxLayout="row">
            <input matInput type="number" id="prix" name="prix" formControlName="prix">
            <span>€</span>
          </div>
          <div class="control" 
            *ngIf="form.get('prix')!.invalid && (form.get('prix')!.dirty || form.get('prix')!.touched)">
            Le nombre doit être > 0
          </div>
        </mat-form-field>
      </div>
    </div>
    <button class="submit" [disabled]="form.invalid" type="submit">Créer l'annonce</button>
  </form>
</div>